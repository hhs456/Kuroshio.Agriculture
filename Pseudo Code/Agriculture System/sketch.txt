
農田系統執行程序 {
	[使用者登入]
	開始執行程序 {
		設定 系統開始時間 為 目前系統時間;
		自 雲端 屯田資料表 下載 系統結束時間;
		自 雲端 屯田資料表 下載 農田資訊集;
		離開歷經時間 = 系統開始時間 - 系統結束時間;
		遍歷 農田資訊集 {
			若 (農田資訊 為 有種植) {
				自 農田資訊 取得 種子資訊;
				自 種子資訊 取得 肥沃度消耗比;
				自 種子資訊 取得 成熟剩餘時間;
				若 (離開歷經時間 <= 成熟剩餘時間) {
					肥沃度消耗值 = 離開歷經時間 * 肥沃度消耗比率;
					若 (剩餘肥沃度 < 肥沃度消耗值) {
						成熟剩餘時間消耗值 = 剩餘肥沃度 * 肥沃度消耗比;
						剩餘肥沃度 = 0;
						成熟剩餘時間 = 成熟剩餘時間 - 成熟剩餘時間消耗值;
						調用 肥沃度不足 事件;
					}
					否則 {
						 // 剩餘肥沃度 >= 肥沃度消耗值						
						成熟剩餘時間消耗值 = 肥沃度消耗值 * 肥沃度消耗比;
						剩餘肥沃度 = 剩餘肥沃度 - 肥沃度消耗值;
						成熟剩餘時間 = 成熟剩餘時間 - 成熟剩餘時間消耗值;
				}
				否則 {
					// 離開歷經時間 > 成熟剩餘時間
					肥沃度消耗值 = 成熟剩餘時間 * 種子肥沃度消耗比率;
					若 (剩餘肥沃度 < 肥沃度消耗值) {
						成熟剩餘時間消耗值 = 剩餘肥沃度 * 肥沃度消耗比;
						剩餘肥沃度 = 0;
						成熟剩餘時間 = 成熟剩餘時間 - 成熟剩餘時間消耗值;
						調用 肥沃度不足 事件;
					}
					否則 {
						// 剩餘肥沃度 >= 肥沃度消耗值
						成熟剩餘時間消耗值 = 肥沃度消耗值 * 肥沃度消耗比;
						剩餘肥沃度 = 剩餘肥沃度 - 肥沃度消耗值;
						成熟剩餘時間 = 0;
						調用 完全成熟 事件;
					}
				}
			}
		}
		轉移 農田系統 至 背景運行;
	}
	[背景運行]
	逐幀執行程序 {
		遍歷 農田資訊集 {
			肥沃度消耗值 = 歷經時間 * 肥沃度消耗比;
			若 (剩餘肥沃度 >=	肥沃度消耗值) {
				若 (農田資訊 為 有種植) {
					成熟剩餘時間 = 成熟剩餘時間 - 歷經時間
					剩餘肥沃度 = 剩餘肥沃度 - 肥沃度消耗值
					若 (成熟剩餘時間 <= 0) {
						調用 完全成熟 事件;
					}
					否則 {
						// 成熟剩餘時間 > 0
						若 (剩餘肥沃度 < 肥沃度消耗值) {
							調用 肥沃度不足 事件;
						}
					}
				}		
			}
		}
	}
	[使用者登出]
	結束執行程序 {
		設定 系統結束時間 為 目前系統時間;
		上傳 系統結束時間 至 雲端 屯田資料表;
		上傳 農田資訊集 至 雲端 屯田資料表;
		調用 農田系統結束 事件;
	}
}